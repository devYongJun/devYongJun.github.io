---
title: HTTP 완벽가이드를 읽고
author: Yongjun
date: 2021-06-15 00:00:00 +0900
categories: [book, http]
tags: [http]
---
![book](../../assets/img/book/httpguide.jpg)

백엔드 개발자로 전직을 위해서 웹의 배경지식을 익히려고 읽은 책이다(꽤 두껍다).

게임개발에서 바이블이라고 불리는 용책이 있듯이 웹개발의 바이블은 이 다람쥐책이 아닐까.. 🐿️

재밌게 술술 읽히는 내용도 있었고, 여러번 다시 봐도 도저히 무슨말인지 이해할수 없는 내용도 있었지만 결과적으로 얻은게 굉장히 많은 책이었다.

나중에 백엔드 경험이 쌓이고 다시 이 책을 읽게 된다면 그때는 지금 얻지 못한 다른 깨달음을 얻을 수 있을 것 같다 .

---

### HTTP (Hypertext Transfer Porotocol)

웹에서 클라이언트와 서버가 데이터를 주고받는 방식으로 현대 인터넷에 공용어라고 말할 수 있다.
`웹 클라이언트가 웹 서버에서 요청 → 웹 서버가 웹 클라이언트에게 응답`이 하나의 HTTP 트랜잭션이다.

---
### MIME

웹 클라이언트가 서버에게 요청하는 리소스는 html, txt, jpeg, avi 등 수많은 종류가 있고 이것들을 MIME(Multipurpose Internet Mail Extensions)라는 라벨을 붙여 구분한다.  
MIME 은 `주 타입/부 타입` 으로 구성된 문자열이며 `text/html, image/jpeg, image/gif, video/quicktime` 과 같이 표기한다.

---
### URI

웹 클라이언트는 웹 서버의 특정 리소스를 식별하는 방식으로 URI(Uniform Resource IDentifier) 를 사용한다.  
URI의 종류로는 URL(Uniform Resource Locator)과 URN(Uniform Resource Name)이 있고 오늘날 대부분의 URI는 URL를 사용하며 `https://dogecoin.com/assets/img/doge.png` 과 같이 표기한다.  
URL의 9개의 요소로 구성되며 실제로 모든 구성요소를 가지는 URL은 거의 없다.  

```
<스킴>://<사용자이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>
```

스킴 : 사용할 프로토콜로 주로 http, ftp 등이 있다.  
사용자 이름, 비밀번호 : 이 정보를 요구하는 대표적인 프로토콜로 ftp가 있다. 입력하지 않으면 기본적으로 anonymous, 이메일 주소가 들어간다.  
호스트 : 우리에게 가장 익숙한 IP주소, 도메인이름이다. ([naver.com](http://naver.com))  
포트 : http는 기본적으로 포트를 입력하지않으면 80을 사용하며 호스트이름과 함께 꼭 있어야 한다. ([naver.com:80](http://naver.com:80))  
경로 : 서버상의 리소스의 위치를 나타낸다.  
파라미터 : 서버가 리소스를 찾는데 필요한 추가정보.  
질의 : 데이터베이스 같은 서비스들은 요청받을 리소스 형식의 범위를 좁히기 위해 질의를 받을 수 있다.  
프래그먼트 : 리소스 안에 있는 특정 부분을 가리킬 수 있다. 리소스 전체가 아닌 일부를 원할때 사용한다.  

---
### Method

HTTP 요쳥메시지에는 어떤 동작이 수행되어야 하는지 구분하는 메서드 타입이있다.  
GET : 서버에 리소스를 달라고 요청하기 위해 쓰인다.  
HEAD : GET 처럼 동작하지만 본문없이 응답한다.  
PUT : 서버에 문서를 쓰는 것을 요청한다.  
POST : 서버에 데이터를 전송하기 위해 설계 되었다.  
TRACE : 메시지가 방화벽,프록시,게이트웨이 등을 지나온 기록을 확인한다.  
OPTIONS : 웹 서버가 어떤 메서드를 지원하는지 알아내기 위해 사용한다.  
DELETE : 서버에 리소스를 삭제 할것을 요청한다.

---
### Status Code

모든 웹 서버의 응답에는 상태 코드가 있다.이 상태코드로 요청이 성공적으로 처리되었는지, 다른 조치가 필요한지 알수 있고 대표적으로 `200 (성공), 302 (다시 시도), 404 (리소스 찾을수 없음)`등이 있다.   
상태코드에는 텍스트로 이루어진 사유구절도 함께 포함되며 이것은 단지 설명만을 위해서 존재하는것일뿐 실제 응답처리는 숫자로된 코드가 사용된다.
  
100~199 : 정보성 상태 코드   
200~299 : 성공 상태 코드  
300~399 : 리다이렉션 상태 코드  
400~499 : 클라이언트 에러 상태 코드  
500~599 : 서버 에러 상태 코드

---
### Message

요청 메세지, 응답 메세지는 `시작줄, 헤더, 본문` 으로 구성되어있다.  
  
시작줄 : 요청이라면 무엇을 해야하는지, 응답이라면 어떤일이 일어났는지 나타낸다.  
헤더 : `이름: 값`으로 구성된 0개이상의 헤더 줄이 있을 수 있다. 헤더의 끝은 빈 줄로 표시한다.  
본문 : 텍스트, 바이너리등 어떠한 데이터도 본문에 들어갈 수 있다.

---
**요청 메세지 구성**

```
<메서드> <요청 URL> <버전>
<헤더>

<본문> # 없을 수도 있다.
```

---
**응답 메시지 구성**

```
<버전> <상태코드> <사유 구절>
<헤더>

<본문> # 없을 수도 있다.
```

---
### TCP/IP (Transmission Control Protocol / Internet Protocol)

HTTP는 TCP라는 신뢰성 있는 인터넷 전송 프로토콜 위에서 동작한다.   
클라이언트가 서버에게 메시지를 전송하기전에 먼저 TCP/IP 연결을 해야 한다.  
연결할 서버를 알아내기위해 IP주소와 포트번호를 사용하며 이 정보는 URL을 통해 알아 낼 수 있다.  
기본적인 절차는 `TCP 연결 → HTTP 요청 → HTTP 응답 → TCP 해제` 순서로 동작한다.

---
### HTTP 트랜잭션 지연

HTTP 트랜잭션이 처리되는 과정은 `DNS찾기 → TCP 연결 → HTTP 요청 → 서버 처리 → 응답` 으로 이루어지는데 서버가 처리하는 시간이 아무리 빠르더라도 앞뒤의 다른 과정들 때문에 어느정도 지연이 발생 할 수 밖에 없다.

---
### TCP 커넥션 핸드셰이크 지연
TCP 연결 `클라이언트의 SYN 요청 → 서버의 SYN+ACK` 과정 이후에 HTTP 요청이 이루어지기때문에 작은 통신을 여러번 할경우 이 핸드셰이크 지연은 더 불편하다.

---
### 병렬(Parallel) 커넥션
여러개의 TCP 커넥션을 통한 동시 HTTP 요청방법이다.   
특정 HTML 페이지에 여러개 이미지들을 있을때 각각의 이미지를 병렬로 요청하여 받는 방식으로 총 지연을 줄일 수 있다.   
하지만 병렬 커넥션이 항상 더 빠른속도를 보장하진 않는다. 커넥션은 메모리를 많이 소모하고 다수의 커넥션을 허용할 경우 `접속 클라이언트 수 * 병렬 커넥션 수`만큼 서버의 부하가 엄청나게 증가하기 떄문이다.     
그래서 서버는 특정 클라이언트로 부터의 과도한 수의 커넥션은 임의로 끊을 수 있으며 브라우저들은 일반적으로 6~8개의 동시 커넥션을 지원한다.   

---
### 지속(Persistent) 커넥션
TCP 연결을 끊지않고 유지하여 재사용하는 방법이다.  
커넥션을 맺기위한 준비작업을 다시 하지않아 지연을 줄일 수 있다.  
하지만 지속커넥션은 잘못 관리할 경우 계속 연결되어있는 커넥션이 쌓여서 성능 저하가 발생 할 수 있다.  
  
---
### Proxy
클라이언트와 서버 사이에서 요청과 응답 중개하는 서버로 보안과 성능 최적화를 위해 쓰인다.  

1. 회사에서 무언가를 다운받을때 바이러스를 검출하거나 학교에서 성인 컨텐츠로 접근을 막는 보안 기능이 있다. 
2. 많은 사용자로부터 자주 요청받는 문서는 프록시가 사본을 가지고 있다가 직접 클라이언트에게 주는 방식으로 원 서버의 통신 부하를 줄일 수 있다.

---
### Gateway 
프록시처럼 클라이언트와 서버 중간에 위치한다.  
서버가 FTP 같은 다른 프로토콜을 사용하더라도 게이트웨이가 처리해 주어 클라이언트는 HTTP 요청만으로 원하는 응답을 받을 수 있다.

`클라이언트 → HTTP 요청 → 게이트웨이 → FTP 요청 → 서버 → FTP 응답 → 게이트웨이 → HTTP 응답 → 클라이언트`

---
### Tunnel  
터널또한 클라이언트와 서버 중간에 위치한다.  
클라이언트와 서버 두 커넥션 사이에서 데이터를 열어보지않고 그대로 전달해준다.  
대표적으로 암호화된 `SSL 트래픽을 HTTP 커넥션으로 전송`해주는 HTTP/SSL 터널이 있다.

---
### Agent
HTTP 요청을 만들어주는 프로그램이다.  
웹 브라우저뿐만 아니라 스스로 웹을 돌아다니면서 콘텐츠를 수집하는 웹 로봇이 있다.

---
### Cache
자주 쓰이는 문서의 사본을 보관하는 장치다.  
웹 요청이 캐시에 도착했을때 사본이 존재한다면 원 서버로 요청을 하지않고 사본을 제공한다.

장점
1. 네트워크 요금 감소
2. 더 빠른 속도
3. 서버 부하 감소

종류
1. 개인 전용 캐시 : 사용자의 개인용 컴퓨터의 디스크와 메모리를 사용
2. 공용 프록시 캐시 : 프록시 서버에서 사본을 저장해두고 여러 동일한 요청에 대해 사본을 제공
   
---
### 웹 로봇
'크롤러', '스파이더', '윔', '봇' 등의 이름으로 불리는 웹로봇은 스스로 웹사이트를 떠돌아다니면서 데이터를 처리한다.  
- 주식시장 서버에서 얻은 데이터로 주가 그래프를 생성하는 로봇
- 웹의 모든 통계를 측정하는 로봇
- 검색엔진이 데이터베이스를 만들기위한 로봇

크롤러는 웹페이지를 하나가져오고 그 웹페이지가 가리키는 다른 하이퍼링크를 가져오고, 또 그 웹페이지의 하이퍼링크를 가져오고.. 재귀적으로 반복하여 웹을 순회하는 로봇이다.

---
### HTTP/2.0
HTTP의 성능문제를 개선하기 위한 버전.     
요청과 응답은 최대 16383바이트의 프레임에 담기고 HTTP 헤더는 압축되어 담긴다.  
프레임에 담긴 요청과 응답은 스트림을 통해 보내지고, 한개의 스트림은 한쌍의 요청과 응답을 처리한다.   
하나의 커넥션 위에 여러개의 스트림이 동시에 만들어질수 있어서 여러개의 요청과 응답 동시처리가 가능하다.(병렬 커넥션없이!)    
서버 푸시도 가능하다.  
클라이언트가 PUSH_PROMISE 프레임을 보내면 푸시를 받을 수 있는 상태가 유지되고, RST_STREAM 프레임을 보내서 푸시를 거절할 수 있다.  

---
🚧 틈날때마다 추가 예정